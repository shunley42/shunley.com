<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.5.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Sam Hunley">

  
  
  
    
  
  <meta name="description" content="In the interest of full disclosure, I’m not actually going to be able to answer the question in the title. Federal spending is just not labeled to that degree of specificity. To really get the answer, you would need to call up a bunch of agencies (likely with FOIA) and ask them (preferably nicely since you just FOIA’d them) to do the math for you.
Instead, what I’m going to do is look at Federal awards (i.">

  
  <link rel="alternate" hreflang="en-us" href="/post/what-does-the-us-federal-government-spend-on-coffee/">

  


  
  
  
  <meta name="theme-color" content="#b49cff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.bf8c3a2192f80e442396b6ab9f2d96d2.css">

  

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/what-does-the-us-federal-government-spend-on-coffee/">

  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@shunley42">
  <meta property="twitter:creator" content="@shunley42">
  
  <meta property="og:site_name" content="Thoughts from Shunley">
  <meta property="og:url" content="/post/what-does-the-us-federal-government-spend-on-coffee/">
  <meta property="og:title" content="What does the US Federal Government Spend on Coffee? | Thoughts from Shunley">
  <meta property="og:description" content="In the interest of full disclosure, I’m not actually going to be able to answer the question in the title. Federal spending is just not labeled to that degree of specificity. To really get the answer, you would need to call up a bunch of agencies (likely with FOIA) and ask them (preferably nicely since you just FOIA’d them) to do the math for you.
Instead, what I’m going to do is look at Federal awards (i."><meta property="og:image" content="/img/static/img/icon-512.png">
  <meta property="twitter:image" content="/img/static/img/icon-512.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-10-23T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2019-10-23T19:35:02-04:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/what-does-the-us-federal-government-spend-on-coffee/"
  },
  "headline": "What does the US Federal Government Spend on Coffee?",
  
  "datePublished": "2019-10-23T00:00:00Z",
  "dateModified": "2019-10-23T19:35:02-04:00",
  
  "author": {
    "@type": "Person",
    "name": "Sam Hunley"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Thoughts from Shunley",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/static/img/icon-512.png"
    }
  },
  "description": "In the interest of full disclosure, I’m not actually going to be able to answer the question in the title. Federal spending is just not labeled to that degree of specificity. To really get the answer, you would need to call up a bunch of agencies (likely with FOIA) and ask them (preferably nicely since you just FOIA’d them) to do the math for you.\nInstead, what I’m going to do is look at Federal awards (i."
}
</script>

  

  


  


  





  <title>What does the US Federal Government Spend on Coffee? | Thoughts from Shunley</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/"><img src="/img/static/img/icon-512.png" alt="Thoughts from Shunley"></a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>What does the US Federal Government Spend on Coffee?</h1>

  
  <p class="page-subtitle">Looking at FY2019 Award Data</p>
  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Oct 23, 2019
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    10 min read
  </span>
  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/analysis/">Analysis</a>, <a href="/categories/r/">R</a>, <a href="/categories/usaspending/">USAspending</a></span>
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      


<p><img src="/post/2019-10-23-what-does-the-us-federal-government-spend-on-coffee_files/coffee.png" /></p>
<p>In the interest of full disclosure, I’m not actually going to be able to answer the question in the title. Federal spending is just not labeled to that degree of specificity. To really get the answer, you would need to call up a bunch of agencies (likely with FOIA) and ask them (preferably nicely since you just FOIA’d them) to do the math for you.</p>
<p>Instead, what I’m going to do is look at Federal awards (i.e., contracts and financial assistance such as grants) that include the word “coffee” in the description. I am without a doubt including some spending where coffee wasn’t involved (e.g., a contract that bought coffee in addition to dinner for a banquet) and missing coffee purchases that simply weren’t labeled in the data.</p>
<p>In short, this analysis is purely for fun and should not be taken too seriously. For the data nerds, you can find my code at the end of the post.</p>
<div id="what-question-are-we-really-asking-here" class="section level2">
<h2>What question are we really asking here?</h2>
<p>Am I interested in what the Federal government spent to support coffee growers (probably in the form of financial assistance like loans and grants)? Am I interested in coffee and coffee supplies purchased for folks on the Federal payroll? To prevent the <a href="https://en.wikipedia.org/wiki/The_Paradox_of_Choice"><strong>paradox of choice</strong></a> from setting in, I decided to let the data guide my decision.</p>
</div>
<div id="financial-assistance-or-contracts" class="section level2">
<h2>Financial Assistance or Contracts?</h2>
<p>Analyzing financial assistance and contracts data at the same time can be a headache. So, I thought, why not eliminate whichever looks the most boring?</p>
<p><img src="/post/2019-10-23-what-does-the-us-federal-government-spend-on-coffee_files/awardTypeTable.png" /></p>
<p>In the table, you can see that contracts accounted for about $4.6 million more than financial assistance in FY 2019. Moreover, there are over 1,900 unique contracts that included the word “coffee”, whereas there’s only 25 financial assistance awards. So, while I’m sure the financial assistance data are interesting in their own way, I’m going to focus on contracts for this analysis.</p>
<p>As a quick note, I relied VERY heavily on Laura Ellis’ <a href="https://www.littlemissdata.com/blog/prettytables"><strong>blog post</strong></a> on the formattable package to make my tables. If you’ve read her post, my style will look super familiar.</p>
</div>
<div id="contracts-whos-doing-the-awarding" class="section level2">
<h2>Contracts: Who’s Doing the Awarding?</h2>
<p>Now that I’ve decided to focus on contracts, the next question is, which agency awarded the most contracts? Time for another table.</p>
<p><img src="/post/2019-10-23-what-does-the-us-federal-government-spend-on-coffee_files/coffeeContracts.png" /></p>
<p>It looks like the Department of Defense issued the most awards for coffee. In fact, 91.6% of all contract obligations with the word “coffee” in the award description are coming from the DoD. Honestly, that makes sense to me. Not only is the DoD one of the largest agencies in terms of employees, it also includes the most employees who are in dire need of caffeination on a regular basis (i.e., folks in the armed forces).</p>
<p>When you look at the awarding subagencies on the coffee contracts, 91% are being handled by the DoD’s Defense Logistics Agency (DLA). This finding fits with what I know from experience about DLA. DLA is the subagency responsible for ensuring that military bases have the foodstuffs they need to function. They are so good at their job, that they have even partnered with the USDA on the <a href="https://www.fns.usda.gov/usda-foods/usda-dod-fresh-fruit-and-vegetable-program"><strong>USDA DoD Fresh program</strong></a> to deliver fresh fruits and vegetables to participating US schools.</p>
</div>
<div id="where-are-these-contracts-going" class="section level2">
<h2>Where are These Contracts Going?</h2>
<p>We now know that DoD had the most contracts that mention coffee in FY 2019, and we know that most of these contracts were handled by DLA. The next step is to figure out where this money is being spent. Looking at the recipient country label, it looks like 87% is going to the US, so let’s focus on that. At this point, I’m itching to make a visualization, and I’m thinking that this is a great opportunity for a choropleth (AKA a heatmap).</p>
<p><img src="/post/2019-10-23-what-does-the-us-federal-government-spend-on-coffee_files/coffeeDLAStates.png" /></p>
<p>Apologies for the small text! I got in a fight with ggplot and blogdown, and it looks like they won. You can right-click on it and select “View Image” to see it in a bigger size. This visualization reveals that most of coffee related awards are being obligated to recipients in California, which makes sense given that it’s the most populous State and has multiple large military bases. Virginia comes in 2nd, followed by Florida, and then, finally, Washington State.</p>
</div>
<div id="in-summary" class="section level2">
<h2>In Summary…</h2>
<p>All told, the US Federal government issued close to $19 million in awards that included the word “coffee” in the description. Of these awards, $11.7 million (62.2%) were contracts, and $10.7 million (91.6%) of these contracts were issued by the Department of Defense. DLA issued the vast majority of these contracts, awarding the funds to recipients both locally as well as globally. Within the US, the majority of these awards were issued to recipients in California.</p>
<p>And there you have it! That’s as far as I’m going to take this analysis. If you want to see the code I used, it’s included below.</p>
</div>
<div id="getting-the-data" class="section level2">
<h2>Getting the Data</h2>
<p>The data I used for this analysis can be accessed through <strong>USASpending.gov</strong> and can be found in the <a href="https://www.usaspending.gov/#/download_center/award_data_archive"><strong>Awards Archive</strong></a>. You will want to download both the contracts and financial assistance data for 2019, and you can ignore the “delta” files. You will end up with 2 fairly large zip files, which, once unzipped, weigh in at around 15 GB. It’s a lot of data, but I found some work arounds that made it fairly easy to process on a 2017 MacBook with only 8 GB of RAM.</p>
</div>
<div id="processing-the-data" class="section level2">
<h2>Processing the Data</h2>
<p>The real heavy lifting here comes in whittling the data down to a manageable size. I ended up opting to process one CSV at a time to prevent my computer from crashing, and then I ran it all through for loops because I’m lazy. You can load the data using any package you like, but I would like to plug <a href="https://www.tidyverse.org/articles/2019/05/vroom-1-0-0/"><strong>vroom</strong></a>. It’s crazy fast at processing large data files.</p>
<pre class="r"><code>######
#
#
# Analyzing FY19 Federal Award (contracts &amp; financial assistance) for &quot;coffee&quot; spending
# All data from USAspending.gov
# Code written by Sam Hunley (@shunley42)
# www.shunley.com
# 10/26/19
#
#
#####



#####
# Loading Packages and Setting Directories
#####
library(tidyverse)
library(vroom)
library(openxlsx)
library(formattable)
library(scales)
library(viridis)

# Create Working Directory Short Cuts
local_dir &lt;- &quot;/Users/samhunley/Desktop&quot;
setwd(local_dir)


#####
# Loading CONTRACT award data
# Looping it so that I don&#39;t fry my Macbook
# The data are the 2019 contracts archive from
# https://www.usaspending.gov/#/download_center/award_data_archive
#####

num_files = length(list.files(path = &quot;2019_all_Contracts_Full_20191009&quot;))
for (j in 1:num_files){
  if (j == 1){
    address = paste(&quot;2019_all_Contracts_Full_20191009/&quot;,
                    &quot;2019_all_Contracts_Full_20191010&quot;, &quot;_&quot;, 1 ,&quot;.csv&quot;, sep = &quot;&quot;)
    contractsA &lt;- vroom(address, delim = &quot;,&quot;, col_select = c(award_id_piid, award_description,
                                                         product_or_service_code,
                                                         product_or_service_code_description, action_date,
                                                         naics_description, awarding_agency_name,
                                                         awarding_sub_agency_name, recipient_name,
                                                         recipient_country_name, recipient_state_name,
                                                         recipient_city_name, federal_action_obligation))
    contractsA$award_description &lt;- gsub(&#39;\&quot;|\\&#39;, &quot;&quot;, contractsA$award_description, fixed = TRUE)
    contractsA &lt;- filter(contractsA, str_detect(str_to_lower(award_description), &quot;coffee&quot;))
    print(paste(&quot;File Completed: &quot;, j))
  } else{
    address = paste(&quot;2019_all_Contracts_Full_20191009/&quot;,
                    &quot;2019_all_Contracts_Full_20191010&quot;, &quot;_&quot;, j ,&quot;.csv&quot;, sep = &quot;&quot;)
    contractsB &lt;- vroom(address, delim = &quot;,&quot;, col_select = c(award_id_piid, award_description,
                                                            product_or_service_code,
                                                            product_or_service_code_description, action_date,
                                                            naics_description, awarding_agency_name,
                                                            awarding_sub_agency_name, recipient_name,
                                                            recipient_country_name, recipient_state_name,
                                                            recipient_city_name, federal_action_obligation))
    contractsB$award_description &lt;- gsub(&#39;\&quot;|\\&#39;, &quot;&quot;, contractsB$award_description, fixed = TRUE)
    contractsB &lt;- filter(contractsB, str_detect(str_to_lower(award_description), &quot;coffee&quot;))
    contractsA &lt;- rbind(contractsA, contractsB)
    print(paste(&quot;File Completed: &quot;, j))
  }
}


saveRDS(contractsA, &quot;coffeeContracts.RData&quot;)


#####
# Loading FINANCIAL ASSISTANCE award data
# Looping it so that I don&#39;t fry my Macbook
# The data are the 2019 contracts archive from
# https://www.usaspending.gov/#/download_center/award_data_archive
#####

num_files = length(list.files(path = &quot;2019_all_Assistance_Full_20191009&quot;))
for (j in 1:num_files){
  if (j == 1){
    address = paste(&quot;2019_all_Assistance_Full_20191009/&quot;,
                    &quot;2019_all_Assistance_Full_20191010&quot;, &quot;_&quot;, 1 ,&quot;.csv&quot;, sep = &quot;&quot;)
    financialA &lt;- vroom(address, delim = &quot;,&quot;, col_select = c(award_id_fain, award_id_uri, award_description,
                                                             cfda_title, action_date, awarding_agency_name,
                                                             awarding_sub_agency_name, recipient_name,
                                                             recipient_country_name, recipient_state_name,
                                                             recipient_city_name, federal_action_obligation))
    financialA$award_description &lt;- gsub(&#39;\&quot;|\\&#39;, &quot;&quot;, financialA$award_description, fixed = TRUE)
    financialA &lt;- filter(financialA, str_detect(str_to_lower(award_description), &quot;coffee&quot;))
    print(paste(&quot;File Completed: &quot;, j))
  } else{
    address = paste(&quot;2019_all_Assistance_Full_20191009/&quot;,
                    &quot;2019_all_Assistance_Full_20191010&quot;, &quot;_&quot;, j ,&quot;.csv&quot;, sep = &quot;&quot;)
    financialB &lt;- vroom(address, delim = &quot;,&quot;, col_select = c(award_id_fain, award_id_uri, award_description,
                                                             cfda_title, action_date, awarding_agency_name,
                                                             awarding_sub_agency_name, recipient_name,
                                                             recipient_country_name, recipient_state_name,
                                                             recipient_city_name, federal_action_obligation))
    financialB$award_description &lt;- gsub(&#39;\&quot;|\\&#39;, &quot;&quot;, financialB$award_description, fixed = TRUE)
    financialB &lt;- filter(financialB, str_detect(str_to_lower(award_description), &quot;coffee&quot;))
    financialA &lt;- rbind(financialA, financialB)
    print(paste(&quot;File Completed: &quot;, j))
  }
}



#####
# Beginning the Analysis
# Looking at what&#39;s in the contracts and financial assistance data sets
# Basically, picking a direction for further analyses
#####

# Total Contract Spend/Number of Awards
# Note: I first eyeballed these to ensure they were actually about coffee - they are

contractTot &lt;- contractsA %&gt;%
  summarise(totalObligations = sum(federal_action_obligation),
            numAwards = n_distinct(award_id_piid)) # $11.7 million
contractTot$fundType &lt;- &quot;Contracts&quot;

# Total Financial Assistance Spend/Number of Awards
# First looking at assistance programs (called CFDAs) to see if they match up
# CFDA Analysis
financialA %&gt;%
  group_by(cfda_title) %&gt;%
  summarize(totalObligations = sum(federal_action_obligation)) %&gt;%
  arrange(desc(totalObligations))

# clearly some noise here, but I need more information
# just going to download to a Excel file

write.xlsx(financialA, &quot;coffeefinancial.xlsx&quot;)

# ALRIGHT, found the CFDAs that I&#39;m not interested in
financialC &lt;- financialA %&gt;%
  filter(cfda_title != &quot;ALLERGY AND INFECTIOUS DISEASES RESEARCH&quot;, cfda_title != &quot;BASIC CENTER GRANT&quot;,
         cfda_title != &quot;DRUG-FREE COMMUNITIES SUPPORT PROGRAM financial&quot;,
         cfda_title != &quot;FOSTER GRANDPARENT PROGRAM&quot;, cfda_title != &quot;HIGHWAY PLANNING AND CONSTRUCTION&quot;,
         cfda_title != &quot;PUBLIC DIPLOMACY PROGRAMS&quot;, cfda_title != &quot;RETIRED AND SENIOR VOLUNTEER PROGRAM&quot;,
         cfda_title != &quot;SCIENCE&quot;, cfda_title != &quot;SUBSTANCE ABUSE AND MENTAL HEALTH SERVICES
         PROJECTS OF REGIONAL AND NATIONAL SIGNIFICANCE&quot;, cfda_title != &quot;TRIO UPWARD BOUND&quot;,
         cfda_title != &quot;VOLUNTEERS IN SERVICE TO AMERICA&quot;)

# Saving the version with just CFDAs of interest
saveRDS(financialC, &quot;coffeeGrants.RData&quot;)

# NOW, actually calculating totals for Financial Assistance
financialTot &lt;- financialC %&gt;%
  summarise(totalObligations = sum(federal_action_obligation),
            numAwards = n_distinct(award_id_fain)) # $7.1 million
financialTot$fundType &lt;- &quot;Financial Assistance&quot;

# Binding contracts and financial assistance to see how they compare
tots &lt;- bind_rows(financialTot, contractTot)

totsSum &lt;- tots %&gt;%
  summarise(totalObligations = sum(totalObligations))

tots &lt;- tots %&gt;%
  group_by(fundType, totalObligations, numAwards) %&gt;%
  summarize(&quot;PercentFunding&quot; = totalObligations/totsSum$totalObligations)

# Formatting data for a table
tots$totalObligations &lt;- dollar(tots$totalObligations)
tots$PercentFunding &lt;- percent(tots$PercentFunding)
tots$numAwards &lt;- comma(tots$numAwards)

# Cleaning the variable names
tots &lt;- tots %&gt;%
  rename(&#39;Award Type&#39; = fundType, &#39;Total Obligations&#39; = totalObligations, &#39;Number of Awards&#39; = numAwards,
         &#39;Percent of FY19 Funding&#39; = PercentFunding)

# attempting a pretty table
# NOTE: code entirely ripped off from: https://www.littlemissdata.com/blog/prettytables
formattable(tots,
            align =c(&quot;l&quot;,&quot;c&quot;,&quot;c&quot;, &quot;c&quot;),
            list(`Award Type` = formatter(
              &quot;span&quot;, style = ~ style(color = &quot;grey&quot;, font.weight = &quot;bold&quot;))
            ))

# This table makes contracts look more interesting to me, so focussing on that


#####
# Further Analyses of Coffee Contracts
# Basically, what&#39;s going on here?
#####

# Analysis by Agency
contractsA %&gt;%
  group_by(awarding_agency_name) %&gt;%
  summarise(totalObligations = sum(federal_action_obligation)) %&gt;%
  arrange(desc(totalObligations)) # Almost ALL of this is DoD (&gt;90%)

# Prepping for a Pretty Table
cTable &lt;- contractsA %&gt;%
  group_by(awarding_agency_name) %&gt;%
  summarise(totalObligations = sum(federal_action_obligation),
            totalAwards = n_distinct(award_id_piid),
            percentFunding = totalObligations/sum(contractsA$federal_action_obligation)) %&gt;%
  filter(totalObligations &gt; 0) %&gt;%
  arrange(desc(totalObligations))

cTable$awarding_agency_name &lt;- str_to_title(gsub(&quot;\\s*\\([^\\)]+\\)&quot;,&quot;&quot;,
                                                  as.character(cWaffle$awarding_agency_name)),
                                                                 locale = &quot;en&quot;)
cTable$totalObligations &lt;- dollar(cTable$totalObligations)
cTable$totalAwards &lt;- comma(cTable$totalAwards)
cTable$percentFunding &lt;- percent(cTable$percentFunding)

cTable &lt;- cTable %&gt;%
  rename(&#39;Total Obligations&#39; = totalObligations,
         &#39;Number of Awards&#39; = totalAwards,
         &quot;Percent of FY19 Contracts Funding&quot; = percentFunding,
         &quot;Awarding Agency&quot; = awarding_agency_name)

formattable(cTable,
            align =c(&quot;l&quot;,&quot;c&quot;,&quot;c&quot;, &quot;c&quot;),
            list(`Awarding Agency` = formatter(
              &quot;span&quot;, style = ~ style(color = &quot;grey&quot;, font.weight = &quot;bold&quot;))
            ))

# Gonna focus on DoD
contractsA %&gt;%
  filter(awarding_agency_name == &quot;DEPARTMENT OF DEFENSE (DOD)&quot;) %&gt;%
  group_by(awarding_sub_agency_name) %&gt;%
  summarise(totalObligations = sum(federal_action_obligation)) %&gt;%
  arrange(desc(totalObligations)) # DLA has, &gt;90% of these contracts. Makes sense.

# Gonna focus on DLA: Where&#39;s the money going?
# US vs Elsewhere
contractsA %&gt;%
  filter(awarding_agency_name == &quot;DEPARTMENT OF DEFENSE (DOD)&quot; &amp;
           awarding_sub_agency_name == &quot;DEFENSE LOGISTICS AGENCY&quot;) %&gt;%
  group_by(recipient_country_name) %&gt;%
  summarise(totalObligations = sum(federal_action_obligation)) %&gt;%
  arrange(desc(totalObligations)) # most going to the US

# Digging deeper in the US spending
usCoffee &lt;- contractsA %&gt;%
  filter(awarding_agency_name == &quot;DEPARTMENT OF DEFENSE (DOD)&quot; &amp;
           awarding_sub_agency_name == &quot;DEFENSE LOGISTICS AGENCY&quot; &amp;
           recipient_country_name == &quot;UNITED STATES&quot;) %&gt;%
  group_by(recipient_state_name) %&gt;%
  summarise(totalObligations = sum(federal_action_obligation)) %&gt;%
  arrange(desc(totalObligations))

#####
# Let&#39;s make a choropleth!
# Admittedly, very little effort was put in here.
# Not a fan of chloropleths, it turns out
#####

# checking that states look pretty
unique(usCoffee$recipient_state_name)
# removing Guam because it&#39;s not on my map
usCoffee$recipient_state_name[usCoffee$recipient_state_name == &quot;GUAM&quot;] &lt;- NA

coffeeStates &lt;- usCoffee %&gt;%
  filter(!is.na(recipient_state_name)) %&gt;% #removes Guam
  group_by(recipient_state_name) %&gt;%
  summarise(totalObligations = sum(totalObligations)) %&gt;%
  arrange(desc(totalObligations))

# This is all being done to work with the package below to get state location data
coffeeStates &lt;- coffeeStates %&gt;%
  rename(state = recipient_state_name)
coffeeStates$state &lt;- tolower(coffeeStates$state)

stateList &lt;- urbnmapr::states #urban institutes state location data
stateList$state_name &lt;- tolower(stateList$state_name)


coffeeStatesFIN &lt;- left_join(stateList, coffeeStates, by = c(&quot;state_name&quot; = &quot;state&quot;))


map &lt;- coffeeStatesFIN %&gt;%
  ggplot(aes(long, lat, group = group, fill = totalObligations)) +
  geom_polygon(color = &quot;grey10&quot;, size = 0.2) +
  scale_fill_viridis(discrete = FALSE) +
  labs(title = &quot;Where DLA &#39;Coffee&#39; Contracts are Going&quot;,
       subtitle = &quot;Fiscal Year 2019&quot;,
       caption = &quot;Created by @Shunley42; Source: USAspending.gov&quot;,
       fill = &quot;Dollars Obligated&quot;) +
  theme_void() +
  theme(panel.background = element_rect(fill = NA, colour = &quot;#cccccc&quot;),
        plot.title = element_text(size = 20,
                                  hjust = 0.5,
                                  family = &quot;Helvetica&quot;,
                                  color = &quot;#000000&quot;),
        plot.subtitle = element_text(size = 15,
                                    hjust = 0.5,
                                    family = &quot;Helvetica&quot;,
                                    color = &quot;#000000&quot;),
        plot.caption = element_text(size = 15,
                                    hjust = 0.5,
                                    family = &quot;Helvetica&quot;,
                                    color = &quot;#000000&quot;),
        legend.title = element_text(size = 10,
                                    hjust = 0.5,
                                    family = &quot;Helvetica&quot;,
                                    color = &quot;#000000&quot;))

map</code></pre>
</div>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/analysis/">Analysis</a>
  
  <a class="badge badge-light" href="/tags/r/">R</a>
  
  <a class="badge badge-light" href="/tags/usaspending/">USAspending</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/what-does-the-us-federal-government-spend-on-coffee/&amp;text=What%20does%20the%20US%20Federal%20Government%20Spend%20on%20Coffee?" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/what-does-the-us-federal-government-spend-on-coffee/&amp;t=What%20does%20the%20US%20Federal%20Government%20Spend%20on%20Coffee?" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=What%20does%20the%20US%20Federal%20Government%20Spend%20on%20Coffee?&amp;body=/post/what-does-the-us-federal-government-spend-on-coffee/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/what-does-the-us-federal-government-spend-on-coffee/&amp;title=What%20does%20the%20US%20Federal%20Government%20Spend%20on%20Coffee?" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=What%20does%20the%20US%20Federal%20Government%20Spend%20on%20Coffee?%20/post/what-does-the-us-federal-government-spend-on-coffee/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/what-does-the-us-federal-government-spend-on-coffee/&amp;title=What%20does%20the%20US%20Federal%20Government%20Spend%20on%20Coffee?" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hu0775fcc1f142940e57f77c3de4562471_16836_250x250_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Sam Hunley</a></h5>
      <h6 class="card-subtitle">Product Owner of Research &amp; Analytics</h6>
      <p class="card-text">I help lead a data analytics team within the US Treasury. All views presented on this site are mine alone.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/shunley42" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/shunley42" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/sam-hunley-905404a4/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/top-recipients-of-us-federal-contracts-in-fy-2018/">Top Recipients of US Federal Contracts in FY 2018</a></li>
      
    </ul>
  </div>
  



  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
      

      
      
    

    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.d6bd04fdad2ad213aa8111c5a3b72fc5.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    
      <a href="/privacy/">Privacy Policy</a>
    
    
       &middot; 
      <a href="/terms/">Terms</a>
    
  </p>
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
